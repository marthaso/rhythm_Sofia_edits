%for batch processing after paramters are build with the software
GoatNumber='G19013';
MaskFile= 'mask14S2.txt'; % NOT USED FOR COMPLETED 

studyMainFolder= '/data/data/Project-Fibrosis/Optical/resultNew';
% Configure
batchG19011_8000_BasePath='/data/data/Project-Fibrosis/Optical/Control/G19011/8000/';
batchG19011_3000_BasePath='/data/data/Project-Fibrosis/Optical/Control/G19011/3000/';
batchG19010_3000_BasePath='/data/data/Project-Fibrosis/Optical/Control/G19010/3000/';

batchG19004_3000_BasePath='/data/data/Project-Fibrosis/Optical/chronic/G19004/';
batchG19003_3000_BasePath='/data/data/Project-Fibrosis/Optical/chronic/g19003/outOfFocus/';
batchG19009BasePath='/data/data/Project-Fibrosis/Optical/Control/G19009/';
batchG19008BasePath='/data/data/Project-Fibrosis/Optical/Control/G19008/';
batchG19012BasePath='/data/data/Project-Fibrosis/Optical/chronic/G19012/gsd/';
batchG19013BasePath='/data/data/Project-Fibrosis/Optical/chronic/G19013/';

switch(GoatNumber)
    case 'batchG19004_3000'
        batchBasePath=batchG19004_3000_BasePath;
        MaskFile= 'mask.txt';
    case 'batchG19003_3000'
        batchBasePath=batchG19003_3000_BasePath;
        MaskFile= 'mask2.txt';
    case 'G19010_3000'
        batchBasePath=batchG19010_3000_BasePath;
        MaskFile= 'mask1.txt';
    case 'G19011_8000'
        batchBasePath=batchG19011_8000_BasePath;
        MaskFile= 'mask14S2.txt';
    case 'G19011_3000'
        batchBasePath=batchG19011_3000_BasePath;
        MaskFile= 'mask14S2.txt';
    case 'G19009'
        batchBasePath=batchG19009BasePath;
        MaskFile= 'mask8.txt';        
    case 'G19008'
        batchBasePath=batchG19008BasePath;        
        MaskFile = 'AAmask5.txt';
    case 'G19012'
        batchBasePath=batchG19012BasePath;        
        MaskFile = 'mask.txt';
    case 'G19013'
        batchBasePath=batchG19013BasePath;        
        MaskFile = 'mask3.txt';
    otherwise
        warn ('Goat Number not known')
        return;
end
ResultsFile  = [batchBasePath 'Results.csv'];
filemask = [batchBasePath MaskFile]; % AAmask4.txt mask8.txt
imageSubfolder = 'images/'; 

%Example
%batch = {{filename, mask,c_start,c_end,{vararg}};
%            {'/data/data/Project-Fibrosis/Optical/Control/G19009/right/right2019-10-18-160750_Ultima (IF1-CAM1).mat', filemask,2.8,3.1,{'bin_state',1}} ;}


batchG19010_3000 = {{[batchG19010_3000_BasePath '/bottom/bottom-30002019-11-20-171123_Ultima (IF1-CAM1).mat'], filemask,[2.6,2.8],[2.67,2.85],{'bin_state',1,},['S1';'S2'],10,'Bottom'} ;
    {[batchG19010_3000_BasePath '/bottom/bottom-30002019-11-20-171226_Ultima (IF1-CAM1).mat'], filemask,[2.07,2.25],[2.14,2.32],{'bin_state',1,},['S1';'S2'],10,'Bottom'} ;
    {[batchG19010_3000_BasePath '/left/left-30002019-11-20-170947_Ultima (IF1-CAM1).mat'], filemask,[1.6,1.79],[1.66,1.84],{'bin_state',1,},['S1';'S2'],10,'left'} ;
    {[batchG19010_3000_BasePath '/left/left-30002019-11-20-171050_Ultima (IF1-CAM1).mat'], filemask,[1.16,1.35],[1.215,1.39],{'bin_state',1,},['S1';'S2'],10,'left'} ;
    };

batchG19011_8000 = {{[batchG19011_8000_BasePath '/bottom/bottom-800K2019-11-13-155010_Ultima (IF1-CAM1).mat'], filemask,[3.8,4.05],[4.0,4.19],{'bin_state',1,'kernel_size', 3,'method_name','asLS','first_drift_param',3},['S1';'S2'],10,'Bottom'} ;
    {[batchG19011_8000_BasePath '/left/left-800K2019-11-13-154922_Ultima (IF1-CAM1).mat'], filemask,[4.02,4.26],[4.125,4.33],{'bin_state',1,'kernel_size', 5,'method_name','asLS','first_drift_param',3},['S1';'S2'],10,'Left'} ;
    {[batchG19011_8000_BasePath '/right/right-800K2019-11-13-155059_Ultima (IF1-CAM1).mat'], filemask,[4.02,4.26],[4.125,4.33],{'bin_state',1,'kernel_size', 5,'method_name','asLS','first_drift_param',3},['S1';'S2'],10,'Left'} ;
    };

% *************************************************************************
%                               CONTROLL 
% *************************************************************************

batchG19008 = {%{[batchG19008BasePath 'bottom/LV2019-10-11-155400_Ultima (IF1-CAM1).mat'], ...
            %filemask,[6.8,7.03],[7.02,7.2],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-200'],10,'Bottom'} ;    
    {[batchG19008BasePath 'bottom/LV2019-10-11-155601_Ultima (IF1-CAM1).mat'], ...
            filemask,[6.8,7.05],[7.05,7.15],{'bin_state',1},['S1    ';'S2-190'],10,'Bottom'} ;       
    {[batchG19008BasePath 'left/RV2019-10-11-154941_Ultima (IF1-CAM1).mat'], ...
            filemask,[7.12,7.35],[7.3,7.5],{'bin_state',1},['S1    ';'S2-170'],10,'Left'}    
    %%{[batchG19008BasePath 'right/HIS2019-10-11-164855_Ultima (IF1-CAM1).mat'], filemask,...
    %%    [1.5,1.7],[1.7,1.82],{'bin_state',1},['S1>SAF';'S2-160'],10,'Right'}    
    {[batchG19008BasePath 'right/HIS2019-10-11-165017_Ultima (IF1-CAM1).mat'], filemask,...
        [1.65,1.802],[1.75,1.89],{'bin_state',1},['S1=>AF';'S2-160'],10,'Right'}    
    %{[batchG19008BasePath 'top/RA-High2019-10-11-160943_Ultima (IF1-CAM1).mat'], filemask,...
    %        [1.6,1.77],[1.75,1.9],{'bin_state',1},['S1=>AF';'S2-130'],10,'Top-High'} 
    {[batchG19008BasePath 'top/RA2019-10-11-154142_Ultima (IF1-CAM1).mat'], filemask,...
            [1.68,1.83],[1.81,1.93],{'bin_state',1},['S1    ';'S2-130'],10,'Top'} 
    };
batchG19009 = {%{'/data/data/Project-Fibrosis/Optical/Control/G19009/bottom/bottom2019-10-18-162112_Ultima (IF1-CAM1).mat', filemask,...
      %[2.8,2.95],[2.9,3.1],{'bin_state',1},['S1    ';'S2-170'],10,'Bottom'} ;    
    {'/data/data/Project-Fibrosis/Optical/Control/G19009/bottom/bottom2019-10-18-163113_Ultima (IF1-CAM1).mat', filemask,...
        [6.1,6.3],[6.25,6.45],{'bin_state',1},['S1    ';'S2-170'],10,'Bottom'} ;    
    {'/data/data/Project-Fibrosis/Optical/Control/G19009/left/Left2019-10-18-160431_Ultima (IF1-CAM1).mat', filemask,...
        [3.75,3.9],[3.85,4.1],{'bin_state',1},['S1    ';'S2-180'],10,'Left'} ;    
    {'/data/data/Project-Fibrosis/Optical/Control/G19009/right/right2019-10-18-160750_Ultima (IF1-CAM1).mat', filemask,...
        [2.8,3.1],[3.0,3.3],{'bin_state',1},['S1    ';'S2-260'],10,'Right'} ;    
    %{'/data/data/Project-Fibrosis/Optical/Control/G19009/top/top2019-10-18-160943_Ultima (IF1-CAM1).mat', filemask,...
    %    [3.24,3.42],[3.4,3.6],{'bin_state',1},['S1    ';'S2-190'],10,'Top'} ;   
    {'/data/data/Project-Fibrosis/Optical/Control/G19009/top/top2019-10-18-161617_Ultima (IF1-CAM1).mat', filemask,...
        [3.25,3.45],[3.45,3.6],{'bin_state',1},['S1    ';'S2-160'],10,'Top'}    ;
    %{[batchG19009BasePath 'sinus/sinus2019-10-18-155845_Ultima (IF1-CAM1).mat'], filemask,[3.95],[4.25],{'bin_state',1},['Sinus'],10,'Sinus'} ;
    %{[batchG19009BasePath 'center/center2019-10-18-163710_Ultima (IF1-CAM1).mat'], filemask,[7.5,7.7],[7.7,7.9],{'bin_state',1},['S1';'S2'],10,'Center'} ;
    };

% batchG19010_3000 = {{[batchG19010_3000_BasePath '/bottom/bottom-30002019-11-20-171226_Ultima (IF1-CAM1).mat'], ...
%         filemask,[2.07,2.25],[2.14,2.32],{'bin_state',1,},['S1    ';'S2-190'],10,'Bottom'} ;
%     {[batchG19010_3000_BasePath '/left/left-30002019-11-20-170947_Ultima (IF1-CAM1).mat'], ...
%         filemask,[1.6,1.79],[1.66,1.84],{'bin_state',1,},['S1    ';'S2-180'],10,'left'} ;
%     {[batchG19010_3000_BasePath '/left/left-30002019-11-20-171050_Ultima (IF1-CAM1).mat'],...
%         filemask,[1.16,1.35],[1.215,1.39],{'bin_state',1,},['S1    ';'S2-180'],10,'left'} ;
%         
%     {[batchG19010_3000_BasePath '/right/Right-30002019-11-20-171335_Ultima (IF1-CAM1).mat'],...
%         filemask,[1.16,1.35],[1.215,1.39],{'bin_state',1,},['S1    ';'S2-190'],10,'left'} ;
%     {[batchG19010_3000_BasePath '/right/Right-30002019-11-20-171841_Ultima (IF1-CAM1).mat'],...
%         filemask,[1.16,1.35],[1.215,1.39],{'bin_state',1,},['S1    ';'S2-190'],10,'left'} ;
%         
%     {[batchG19010_3000_BasePath '/top/top-30002019-11-20-170911_Ultima (IF1-CAM1).mat'],...
%         filemask,[1.16,1.35],[1.215,1.39],{'bin_state',1,},['S1    ';'S2-210'],10,'left'} ;
%     };


batchG19011_3000 = {{[batchG19011_3000_BasePath '/bottom/bottom-3000k2019-11-13-161120_Ultima (IF1-CAM1).mat'],... 
            filemask,[4.9,5.13],[5.0,5.22],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-240'],10,'Bottom'} ;
            
        %{[batchG19011_3000_BasePath '/left/left-3000k2019-11-13-161046_Ultima (IF1-CAM1).mat'], ...
        %    filemask,[4.17,4.38],[4.22,4.44],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-220'],10,'Left'} ;
        {[batchG19011_3000_BasePath '/left/left2019-11-13-151702_Ultima (IF1-CAM1).mat'], ...
            filemask,[1.8,2.01],[1.85,2.04],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-220'],10,'Left'} ;
        
        {[batchG19011_3000_BasePath '/right/right-3000k2019-11-13-161306_Ultima (IF1-CAM1).mat'], ...
            filemask,[3.07,3.25],[3.13,3.35],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-200'],10,'Right'} ;    
        
        {[batchG19011_3000_BasePath '/top/top-3000k2019-11-13-161011_Ultima (IF1-CAM1).mat'],...
            filemask,[3.95,4.17],[4.05,4.25],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-220'],10,'Top'} ;
        
        
    };






% *************************************************************************
%                               CHRONIC 
% *************************************************************************

batchG19004_3000 = {%{[batchG19004_3000_BasePath '/bottom/bottom3000s22019-11-26-155844_Ultima (IF1-CAM1).mat'], ...
            %filemask,[3.0,3.25],[3.1,3.5],{'bin_state',1},['S1    ';'S2-250'],10,'Bottom'} ;    
    {[batchG19004_3000_BasePath '/bottom/bottom3000s22019-11-26-155806_Ultima (IF1-CAM1).mat'], ...
            filemask,[3.99,4.22],[4.08,4.45],{'bin_state',1,'kernel_size',5},['S1    ';'S2-240'],10,'Bottom'} ;
            
    {[batchG19004_3000_BasePath '/left/left3000s22019-11-26-152137_Ultima (IF1-CAM1).mat'], ...
            filemask,[4.0,4.37],[4.25,4.49],{'bin_state',1,'kernel_size',5},['S1    ';'S2-270'],10,'left'} ;
    
    %{[batchG19004_3000_BasePath '/right/right3000s22019-11-26-153656_Ultima (IF1-CAM1).mat'], ...    
    %        filemask,[3.85,4.1],[4.05,4.25],{'bin_state',1,'kernel_size',3},['S1    ';'S2-220'],10,'right'} ;                    
    %{[batchG19004_3000_BasePath '/right/right3000s22019-11-26-154152_Ultima (IF1-CAM1).mat'], ...    
    %        filemask,[3.9,4.17],[4.1,4.34],{'bin_state',1,'kernel_size',3},['S1    ';'S2-210'],10,'right'} ;                                
    %{[batchG19004_3000_BasePath '/right/right3000s22019-11-26-154414_Ultima (IF1-CAM1).mat'], ...    
    %        filemask,[4.23,4.47],[4.4,4.66],{'bin_state',1,'kernel_size',3},['S1    ';'S2-200'],10,'right'} ;
    %{[batchG19004_3000_BasePath '/right/right3000s22019-11-26-154604_Ultima (IF1-CAM1).mat'], ...    
    %        filemask,[4.3,4.6],[4.5,4.79],{'bin_state',1,'kernel_size',3},['S1    ';'S2-190'],10,'right'} ;            
    {[batchG19004_3000_BasePath '/right/right3000s22019-11-26-154654_Ultima (IF1-CAM1).mat'], ...
            filemask,[3.9,4.25],[4.2,4.4],{'bin_state',1,'kernel_size',3},['S1    ';'S2-180'],10,'right'} ;
            
    {[batchG19004_3000_BasePath '/top/top3000s22019-11-26-150607_Ultima (IF1-CAM1).mat'], ...
            filemask,[3.3,3.6],[3.5,3.67],{'bin_state',1,'kernel_size',3},['S1    ';'S2-190'],10,'top'} ;
            
};

batchG19003_3000 = {{[batchG19003_3000_BasePath '/bottom/bottom3000-S22019-11-22-154425_Ultima (IF1-CAM1).mat'],...
        filemask,[4.96,5.14],[5.03,5.22],{'bin_state',1},['S1    ';'S2-180'],10,'Bottom'} ; 
    
    {[batchG19003_3000_BasePath '/left/left3000-S22019-11-22-154125_Ultima (IF1-CAM1).mat'], ...
        filemask,[5.05,5.25],[5.2,5.35],{'bin_state',1},['S1    ';'S2-160'],10,'Left'} ;% Validated
        
    {[batchG19003_3000_BasePath '/right/right3000-S22019-11-22-163833_Ultima (IF1-CAM1).mat'], ...
        filemask,[4.71,4.93],[4.85,4.99],{'bin_state',1,'method_name','asLS','first_drift_param',3},['S1    ';'S2-150'],10,'right'} ;% Validated
    
    {[batchG19003_3000_BasePath '/top/top3000-S22019-11-22-153702_Ultima (IF1-CAM1).mat'], ...
        filemask,[4.7,4.95],[4.9,5.05],{'bin_state',1,},['S1    ';'S2-160'],10,'top'} ;% Validated
};

batchG19012 = {%{[batchG19012BasePath 'left/left S2  2502020-07-10-151956_Ultima (IF1-CAM1).mat'], filemask,...
               %     [2.8,3.07],[2.93,3.18],{'bin_state',1,'drift_state',0},['S1    ';'S2-250'],10,'Bottom'} ;    
                %{[batchG19012BasePath 'left/left S2  2202020-07-10-152017_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.65],[3.75],{'bin_state',1,'drift_state',0},['S2-220'],10,'Bottom'} ; 
                %{[batchG19012BasePath 'left/left S2  2002020-07-10-152035_Ultima (IF1-CAM1).mat'], filemask,...
                %    [2.36],[2.50],{'bin_state',1,'drift_state',0},['S2-220'],10,'Bottom'} ;
                {[batchG19012BasePath 'left/left S2 1902020-07-10-152101_Ultima (IF1-CAM1).mat'], filemask,...
                    [3.45,3.67],[3.57,3.8],{'bin_state',1,'drift_state',0},['S1    ';'S2-190'],10,'Bottom'} ;  
                    
                %{[batchG19012BasePath 'bottom/bottom S2 2502020-07-10-150650_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.55,3.75],[3.7,3.85],{'bin_state',1,'drift_state',0},['S1    ';'S2-250'],10,'Left'} ;  
                %{[batchG19012BasePath 'bottom/bottom S2 2202020-07-10-150712_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.86],[3.94],{'bin_state',1,'drift_state',0},['S2-220'],10,'Left'} ;  
                %{[batchG19012BasePath 'bottom/bottom S2 2002020-07-10-150745_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.68],[3.74],{'bin_state',1,'drift_state',0},['S2-200'],10,'Left'} ;                      
                {[batchG19012BasePath 'bottom/bottom S2 1802020-07-10-150818_Ultima (IF1-CAM1).mat'], filemask,...
                    [2.9,3.1],[2.985,3.185],{'bin_state',1,'drift_state',0},['S1    ';'S2-180'],10,'Left'} ; 
                    
                %{[batchG19012BasePath 'top/top S2 3002020-07-10-144630_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.27,3.5],[3.33,3.66],{'bin_state',1,'drift_state',0},['S1    ';'S2-300'],10,'Top'} ; 
                %{[batchG19012BasePath 'top/top S2 2502020-07-10-144715_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.51],[3.61],{'bin_state',1,'drift_state',0},['S2-250'],10,'Top'} ; 
                %{[batchG19012BasePath 'top/top S2 2202020-07-10-144759_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.72],[3.8],{'bin_state',1,'drift_state',0},['S2-220'],10,'Top'} ; 
                {[batchG19012BasePath 'top/top S2 1702020-07-10-144943-1_Ultima (IF1-CAM1).mat'], filemask,...
                    [3.65,3.85],[3.75,4.0],{'bin_state',1,'drift_state',0},['S1    ';'S2-170'],10,'Top'} ; 
                    
                %{[batchG19012BasePath 'right/right S2 2502020-07-10-152918_Ultima (IF1-CAM1).mat'], filemask,...
                %    [3.2],[3.26],{'bin_state',1,'drift_state',0},['S1'],10,'right'} ; 
                {[batchG19012BasePath 'right/right S2 2502020-07-10-152918_Ultima (IF1-CAM1).mat'], filemask,...
                    [3.2,3.45],[3.26,3.53],{'bin_state',1,'drift_state',0},['S1    ';'S2-250'],10,'right'} ; 
                    };

            
batchG19013 = {...
    %{[batchG19013BasePath '/bottom/Bottom S2 3502020-08-07-140547_Ultima (IF1-CAM1).mat'], filemask,...
    %                [3.2,3.55],[3.35,3.69],{'bin_state',1},['S1    ';'S2-350'],10,'Bottom'} ;
    %{[batchG19013BasePath '/bottom/Bottom S2 3002020-08-07-140610_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.8,4.16],[3.9,4.24],{'bin_state',1},['S2-300';'300-#2'],10,'Bottom'} ;
    %{[batchG19013BasePath '/bottom/Bottom S2 2502020-08-07-140628_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [2.28,2.58],[2.4,2.73],{'bin_state',1},['S2-250';'250-#2'],10,'Bottom'} ;
    {[batchG19013BasePath '/bottom/Bottom S2 2402020-08-07-140649_Ultima (IF1-CAM1).mat'], filemask, ...
                    [2.74,3.0,3.29],[2.81,3.12,3.43],{'bin_state',1},['S1    ';'S2-240';'240-#2'],10,'Bottom'} ;
    
    %{[batchG19013BasePath '/left/Left S2 3502020-08-07-135828_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.35,3.7],[3.49,3.85],{'bin_state',1},['S2-350';'350-#2'],10,'Left'} ;
    %{[batchG19013BasePath '/left/Left S2 3002020-08-07-135913_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.61,3.9],[3.68,4.0],{'bin_state',1},['S2-300';'300-#2'],10,'Left'} ;
    %{[batchG19013BasePath '/left/Left S2 2502020-08-07-135936_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.63,4],[3.72,4.1],{'bin_state',1},['S2-250';'250-#2'],10,'Left'} ;
    %{[batchG19013BasePath '/left/Left S2 2402020-08-07-135958_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.47,3.83],[3.55,3.9],{'bin_state',1},['S2-240';'240-#2'],10,'Left'} ;
    %{[batchG19013BasePath '/left/Left S2 2302020-08-07-140022_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [2.58,2.83],[2.7,2.95],{'bin_state',1},['S2-230';'230-#2'],10,'Left'} ;
    %{[batchG19013BasePath '/left/Left S2 220 real2020-08-07-140134_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [5.9,6.25],[6,6.33],{'bin_state',1},['S2-220';'220-#2'],10,'Left'} ;
    {[batchG19013BasePath '/left/Left S2 2102020-08-07-140205_Ultima (IF1-CAM1).mat'], filemask, ...
                    [3.72,3.95,4.35],[3.80,4.1,4.43],{'bin_state',1},['S1    ' ;'S2-210';'210-#2'],10,'Left'} ;
                    
    %{[batchG19013BasePath '/right/Right S2 3502020-08-07-140948_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.3,3.64],[3.36,3.75],{'bin_state',1},['S1-500';'S2-350'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 3002020-08-07-141009_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [4.9],[5.02],{'bin_state',1},['S2-300'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 2502020-08-07-141038_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.8],[3.93],{'bin_state',1,'kernel_size',5},['S2-250'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 2402020-08-07-141101_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.2],[3.35],{'bin_state',1,'kernel_size',5},['S2-240'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 2302020-08-07-141123_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.5],[3.65],{'bin_state',1,'kernel_size',3},['S2-230'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 2202020-08-07-141145_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.7],[3.85],{'bin_state',1,'kernel_size',3},['S2-220'],10,'Right'} ;
    %{[batchG19013BasePath '/right/Right S2 2102020-08-07-141207_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.4],[3.52],{'bin_state',1,'kernel_size',3},['S2-210'],10,'Right'} ;
    {[batchG19013BasePath '/right/Right S2 2002020-08-07-141229_Ultima (IF1-CAM1).mat'], filemask, ...
                    [3.17, 3.47],[3.25,3.59],{'bin_state',1,'kernel_size',3},['S1    ' ;'S2-200'],10,'Right'} ;
                    
    %{[batchG19013BasePath '/top/Top S2 3502020-08-07-134823_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [2.33,2.7],[2.45,2.81],{'bin_state',1},['S1-500';'S2-350'],10,'Top'} ;
    %{[batchG19013BasePath '/top/Top S2 3002020-08-07-134850_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.76,4.1],[3.85,4.18],{'bin_state',1},['S2-300';'300-#2'],10,'Top'} ;
    %{[batchG19013BasePath '/top/Top S2 2502020-08-07-134936_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.24,3.6],[3.35,3.7],{'bin_state',1},['S2-250';'250-#2'],10,'Top'} ;
    %{[batchG19013BasePath '/top/Top S2 2402020-08-07-135109_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [4.48,4.77],[4.58,4.92],{'bin_state',1},['S2-240';'240-#2'],10,'Top'} ;
    %{[batchG19013BasePath '/top/Top S2 2302020-08-07-135134_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [1.87,2.2],[1.94,2.25],{'bin_state',1},['S2-230';'230-#2'],10,'Top'} ;
    %{[batchG19013BasePath '/top/Top S2 2202020-08-07-135626_Ultima (IF1-CAM1).mat'], filemask, ...
    %                [3.89,4.22],[3.95,4.35],{'bin_state',1},['S2-220';'220-#2'],10,'Top'} ;                    
    {[batchG19013BasePath '/top/Top S2 2102020-08-07-135712_Ultima (IF1-CAM1).mat'], filemask, ...
                    [1.76,2,2.33],[1.85,2.085,2.4],{'bin_state',1},['S1    ' ;'S2-210';'210-#2'],10,'Top'} ;                    
                    
};

            
switch(GoatNumber)
    case 'batchG19004_3000'
        batch=batchG19004_3000;
    case 'batchG19003_3000'
        batch=batchG19003_3000;
    case 'G19011_8000'        
        batch=batchG19011_8000;
    case 'G19011_3000'        
        batch=batchG19011_3000;
    case 'G19010_3000'        
        batch=batchG19010_3000;
    case 'G19009'        
        batch=batchG19009;
    case 'G19008'        
        batch=batchG19008;        
    case 'G19012'        
        batch=batchG19012;        
    case 'G19013'        
        batch=batchG19013;
    otherwise
        warn ('Goat Number not known')
        return;
end


fid= fopen(ResultsFile,'w');
%write header
seperator =',';
fprintf(fid,['Position ' seperator ...
    ' cStart ' seperator ...
    ' cEnd   ' seperator ...
    ' Stimulation '  seperator ...
    ' CvMean ' seperator ...
    ' CvMedian  ' seperator ...
    ' CvStd      ' seperator ...
    ' slowPercentage ' seperator ...
    ' normalPercent  ' seperator ...    
    ' usabelRegionPercentage' seperator ... 
    ' countSlowCondtionAreas' seperator ... 
    ' statsAllMean.Area.mean ' seperator ... 
    ' statsAllMean.Area.std ' seperator ... 
    ' statsAllMean.Ratio.mean ' seperator ... 
    ' statsAllMean.Ratio.std ' seperator ... 
    ' statsAllMean.Gender.mean ' seperator ... 
    ' statsAllMean.Gender.std ' seperator ... 
    ' statsRegionMean.Area.mean ' seperator ... 
    ' statsRegionMean.Area.std ' seperator ... 
    ' statsRegionMean.Ratio.mean ' seperator ... 
    ' statsRegionMean.Ratio.std ' seperator ... 
    ' statsRegionMean.Gender.mean ' seperator ... 
    ' statsRegionMean.Gender.std ' seperator ... 
    ' LineLikeMean.Area.mean ' seperator ... 
    ' LineLikeMean.Area.std ' seperator ... 
    ' LineLikeMean.Ratio.mean ' seperator ... 
    ' LineLikeMean.Ratio.std ' seperator ... 
    ' LineLikeMean.Gender.mean ' seperator ... 
    ' LineLikeMean.Gender.std ' seperator ... 
    ' FrakturedPatternMean.Area.mean ' seperator ... 
    ' FrakturedPatternMean.Area.std ' seperator ... 
    ' FrakturedPatternMean.Ratio.mean ' seperator ... 
    ' FrakturedPatternMean.Ratio.std ' seperator ... 
    ' FrakturedPatternMean.Gener.mean ' seperator ... 
    ' FrakturedPatternMean.Gender.std ' seperator ... 
    ' CountLineLike ' seperator ... 
    ' CountFrakturedPattern ' seperator ... 
    ' Angle_mean ' seperator ...
    ' Num_Vectors ' seperator ...
    ' Filename ' '\n' ]);

[filepath,name,ext] = fileparts(ResultsFile);
pdfFile =fullfile(filepath,['Batch', char(datetime('now','Format','y-M-d_HH:mm'))  ,'.ps']);
fs = figure('visible','on');
set(gca,'visible','off')
text(0.,0.9,['Batch', char(datetime('now','Format','y-M-d_HH:mm'))],'FontWeight','bold')
print(fs,pdfFile,'-dpsc','-fillpage')
close(fs)
for i = 1:size(batch,1)
    
    disp(['!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\nFile ' int2str(i) ' of ' int2str( size(batch,1)) '\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n'])
    
    [h,dataLat,dataCV,saveDataCVVec,meanresults, medianresults,SDresults,...
          angleresults,num_membersresults]=AutomaticFunction(batch{i}{1},batch{i}{2},batch{i}{3},batch{i}{4},batch{1}{5}{:});
    %Save the image
    [filepath,name,ext] = fileparts(batch{i}{1});
    name=strrep(name,' ', '');
    val_map_step = 0.002;% str2double(get(source,'String'));
    if (val_map_step < 1 / h.activeCamData.Fs)
        %set(source,'String', num2str(1 / handles.activeCamData.Fs));
        val_map_step = 1 / h.activeCamData.Fs;
    end
    if (val_map_step >= (batch{i}{4} - batch{i}{3}))
        val_map_step = batch{i}{4} - batch{i}{3};
    end
    
    %         handles.numOfContourLevels = round(val_map_step * handles.activeCamData.Fs)+1;
    h.numOfContourLevels = round((batch{i}{4} - batch{i}{3}) / val_map_step) + 1;
    
    %%Page per case
    fs = figure('visible','on');
    set(gca,'visible','off')
    text(0.0,0.5,batch{i}{1},'FontWeight','bold');
    print(fs,pdfFile,'-dpsc','-fillpage','-append')
    close(fs)
    % loop over all beats
    numOfBeats= length(batch{i}{3});
    %Make Sure the folder is there.
    if exist(fullfile(filepath,imageSubfolder), 'dir')~=7
       mkdir(fullfile(filepath,imageSubfolder))
    end
    for j=1:numOfBeats
        %Export LAT
        fLat = figure('visible','on');
        isDrawIsolines = 0;
        if isDrawIsolines
            contourf(flipud(dataLat{j}),h.numOfContourLevels(j),'LineColor','k');
        else
            contourf(flipud(dataLat{j}),h.numOfContourLevels(j),'LineColor','none');
        end
        colormap jet;
        colorbar;
        disp(['i=' num2str(i) ', j=' num2str(j)])
        imgFile =fullfile(filepath,imageSubfolder,[name,'-LAT-',batch{i}{6}(j,:), '.jpg']);
        
        saveas(fLat,imgFile)
        %text(0.5,110.,[name,'-LAT-',batch{i}{6}, '.jpg'])
        title(['LAT - ' batch{i}{6}(j,:)])
        print(fLat,pdfFile,'-dpsc','-append')
   
        close(fLat);
        
        % Export CV
        % = figure('visible','off');
        
        fCV = figure('visible','on');
        
        startp = round(batch{i}{3}(j)*h.activeCamData.Fs);
        endp = round(h.activeCamData.Fs*batch{i}{4}(j));
        %isDrawIsolines = get(isolinesCheckBox,'Value');
        if isDrawIsolines
            contourf(flipud(dataCV{j}),h.numOfContourLevels(j),'LineColor','k');
        else
            contourf(flipud(dataCV{j}),h.numOfContourLevels(j),'LineColor','none');
        end
         sz=size(dataCV{j});
        ax1=gca;
        ax2 = axes;
        linkaxes([ax1,ax2])
        X=saveDataCVVec{j}(:,1);
        Y=sz(2)-saveDataCVVec{j}(:,2);
        C=saveDataCVVec{j}(:,5);
        scatter(ax2,X,Y,[],C,'s');%'filled'
        
        ax2.Visible = 'off';
        ax2.XTick = [];
        ax2.YTick = [];
        colormap(ax2,'hot')
        set([ax1,ax2],'Position',[.17 .11 .685 .815]);
        cb1 = colorbar(ax1,'Position',[.05 .11 .0675 .815]);
        cb2 = colorbar(ax2,'Position',[.88 .11 .0675 .815]);
        title(['CV - ' batch{i}{6}(j,:)])
        imgFile =fullfile(filepath,imageSubfolder,[name,'-CV-Two-',batch{i}{6}(j,:), '.jpg']);
        saveas(fCV,imgFile)
        print(fCV,pdfFile,'-dpsc','-append')
        close(fCV);
        fCV = figure('visible','on');
         if isDrawIsolines
            contourf(flipud(dataCV{j}),h.numOfContourLevels(j),'LineColor','k');
        else
            contourf(flipud(dataCV{j}),h.numOfContourLevels(j),'LineColor','none');
        end
        %contourf(flipud(handles.activeCamData.saveData), handles.numOfContourLevels,'LineColor','k');
        hold on;
       
        quiver_step = 2;
        %saveDataCVVec{j}(1)
        %VecArray = [X_plot Y_plot Vx_plot Vy_plot V];
        q = quiver(saveDataCVVec{j}(1:quiver_step:end,1),...
            sz(2)-saveDataCVVec{j}(1:quiver_step:end,2),...
            saveDataCVVec{j}(1:quiver_step:end,3), ...
            saveDataCVVec{j}(1:quiver_step:end,4),'w');
        %             q.LineWidth = 2;
        %             q.AutoScaleFactor = 2;
        hold off;
        colorbar;
        imgFile =fullfile(filepath,imageSubfolder,[name,'-CV-',batch{i}{6}(j,:), '.jpg']);
        saveas(fCV,imgFile)
        %text(0.5,110.0,[name,'-CV-',batch{i}{6}, '.jpg'])
        title(['CV - ' batch{i}{6}(j,:)])
        print(fCV,pdfFile,'-dpsc','-append')
        close(fCV);
        %Get Histrogram of CV
        
        fHisto = figure('visible','on');
        histogram(C,50)
        title(['CV Histrogram - ' batch{i}{6}(j,:)])
        imgFile =fullfile(filepath,imageSubfolder,[name,'-Histogram-',batch{i}{6}(j,:), '.jpg']);
        saveas(fHisto,imgFile)
        print(fHisto,pdfFile,'-dpsc','-append')
        close(fHisto);
        %Export the CV's
        %csvFile =fullfile(filepath,[name,'-Histogram-',batch{i}{6}(j,:), '.csv']);
        
        [filepathMask,namemask,ext] = fileparts(filemask);
        csvFile =fullfile(filepathMask,['Histogram-Full', '.csv']);
        fidcsv=fopen(csvFile,'a');
        fprintf(fidcsv,"%f\n",C);
        fclose(fidcsv);
        %%Save CV map as matric
        CVmatrix= ones(100,100)*(-1);
        for ii = 1:size(saveDataCVVec{j},1)
            CVmatrix( saveDataCVVec{j}(ii,1) , saveDataCVVec{j}(ii,2) ) =...
                saveDataCVVec{j}(ii,5);
        end
        dataFile =fullfile(filepath,imageSubfolder,[name,'-CV-',batch{i}{6}(j,:), '']);
        save(dataFile,'CVmatrix');
        
        [slowPercentage,normalPercent,regionImg,usabelRegionPercentage,...
            countSlowCondtionAreas,...
            statsAllMean,statsRegionMean,LineLikeMean,FrakturedPatternMean,...
                RegionSlow,LineLike,FrakturedPattern] =...
            GetSlowRegion (CVmatrix);
        CountLineLike=size(LineLike,1);
        CountFrakturedPattern=size(FrakturedPattern,1);
        fCV = figure('visible','on');
        ax1=gca;
        imagesc(ax1,regionImg')        
        ax1.Visible = 'off';ax1.XTick = [];ax1.YTick = [];        
        title(['CV - Region- ' batch{i}{6}(j,:)])
        imgFile =fullfile(filepath,imageSubfolder,[name,'-CV-Region',batch{i}{6}(j,:), '.jpg']);
        saveas(fCV,imgFile)
        print(fCV,pdfFile,'-dpsc','-append')
        close(fCV);
        
        %Do a paired student t test between S1 and S2
        %First copy velozity data in organised array
        %saveDataCVVec{1}(:,5);
        cv=cell(size(saveDataCVVec));
        
        
        for ci=1: size(cv,1)
            cv{ci}=nan(size(dataCV{ci}));
            for cn = 1: size(saveDataCVVec{ci,1},1)
                cv{ci}(saveDataCVVec{ci,1}(cn,1),saveDataCVVec{ci,1}(cn,2))=...
                       saveDataCVVec{ci,1}(cn,5);
            end
            %Now we have an image of CV                         
        end
        imgFile =fullfile(filepath,imageSubfolder,[name,'-CV-IMG-',batch{i}{6}(j,:), '.mat']);
        CurrentCV=cv{j};
        save(imgFile,'CurrentCV')
        %Matrix of all tests
        cvtest=cell(size(saveDataCVVec,1));
        for ci=1: size(cvtest,1)
            for cj=ci: size(cvtest,1)
                [hyp,p]=ttest(cv{ci}(:),cv{cj}(:));
                cvtest{ci,cj}=[hyp,p];
            end
        end
        fidTest= fopen([batchBasePath 'GoatNumber.csv'],'w');
        for ci=1: size(cvtest,1)
            for cj=1: ci-1
                     fprintf(fidTest,[' NAN '  seperator]); 
            end
            for cj=ci: size(cvtest,1)
                 if(isvector( cvtest{ci,cj}))
                    fprintf(fidTest,[' %3.4e '  seperator],cvtest{ci,cj}(1,2));
                 else
                    fprintf(fidTest,[' NAN '  seperator]); 
                 end
                    
            end
            fprintf(fidTest,'\n');
        end
        
        fclose(fidTest);
        %write in table file
        fprintf(fid,[' %s ' seperator ...
            '%3.4f ' seperator ...
            ' %3.4f ' seperator ...            
            ' %11s '  seperator ...
            ' %8.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ...
            ' %3d ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...            
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %6.4f ' seperator ...
            ' %3d ' seperator ...
            ' %3d ' seperator ...
            ...
            ' %6.4f ' seperator ...
            ' %9d ' seperator ...
            ' "%s" ' '\n'],...
            batch{i}{8},...
            batch{i}{3}(j),...
            batch{i}{4}(j),...
            batch{i}{6}(j,:),...
            meanresults(j),...
            medianresults(j),...
            SDresults(j),...
            ...
            slowPercentage,normalPercent,usabelRegionPercentage, ...
            countSlowCondtionAreas,...
            statsAllMean.Area(1), statsAllMean.Area(2),...
            statsAllMean.ratio(1), statsAllMean.ratio(2),...
            statsAllMean.gender(1), statsAllMean.gender(2),...
            statsRegionMean.Area(1),statsRegionMean.Area(2),...
            statsRegionMean.ratio(1),statsRegionMean.ratio(2),...
            statsRegionMean.gender(1),statsRegionMean.gender(2),...
            LineLikeMean.Area(1),LineLikeMean.Area(2),...
            LineLikeMean.ratio(1),LineLikeMean.ratio(2),...
            LineLikeMean.gender(1),LineLikeMean.gender(2),...
            FrakturedPatternMean.Area(1), FrakturedPatternMean.Area(2),...
            FrakturedPatternMean.ratio(1), FrakturedPatternMean.ratio(2),...
            FrakturedPatternMean.gender(1), FrakturedPatternMean.gender(2),...
            CountLineLike,CountFrakturedPattern,...    
            ...
            angleresults(j),...
            num_membersresults(j),...
            batch{i}{1}...
            );
    end
    
end
fclose(fid);
copyfile (ResultsFile ,fullfile(studyMainFolder,GoatNumber +"-Result.csv"))

%Lets do some statistis
%handles.activeCamData.VecArray
